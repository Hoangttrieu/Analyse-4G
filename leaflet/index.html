<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
   <head profile="http://gmpg.org/xfn/11">
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 
      <link rel="stylesheet" type="text/css" href="library/leaflet/leaflet.css" />
      
      <script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
      <script type='text/javascript' src='library/leaflet/leaflet.js'></script>
	   <script type='text/javascript' src='library/turfjs/turf.min.js'></script>
   </head>
 
   <body>
		<h1>Leaflet Example</h1> 
		<!-- <p>Here's a map of the countries I've either lived in or travelled through for a month or more. -->
		<div id="map" style="float: left; height: 600px; width: 1200px; border: 1px solid #AAA;"></div>
		<div id="note" style="float: left; padding-left: 50px;"></div>
		
		
		<script>
		var map = L.map('map').setView([48.174665, -2.010904], 10);

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
			
		var cellJsonList = [];
		var skip = 0;
		var take = 20;
		var point = {
				"type": "FeatureCollection",
				"properties":"",
				"features" : []
			}
		
		$(document).ready(function(){
		var markerGroup = L.layerGroup();
		var pointinside = [];
		var markers = L.MarkerClusterGroup()
			$.getJSONorder("jsontest.json", function(jsonList) {
				
				cellJsonList = jsonList;	
				var cellGeoList=[];
				var pointborder=[]
				
				cellJsonList.forEach(function(item){
					
					cellGeoList.push(createFeatureCollection(item))
					points=createpolygon(item)
					
					pointinside.push(points[0])
					pointborder.push(points[1])
					
				})
	
				pointinside.forEach(function(item){	
						item.features.forEach(function (fea){
					L.marker([fea.geometry.coordinates[1],fea.geometry.coordinates[0]]).addTo(markerGroup)
						//	console.log(fea)
							//createpolygon(fea,pointBorder)
						//	L.marker([fea.geometry.coordinates[1],fea.geometry.coordinates[0]]).addTo(map)
						//	console.log(createpolygon(fea,pointBorder))
						})	
				//----------------------------------------------
				})
				pointborder.forEach(function(item){	
					//console.log(item)
					L.geoJSON([turf.convex(item)],{style: style}).addTo(map);
				//	markers.addLayer(L.marker([item.geometry.coordinates[1],item.geometry.coordinates[0]]))
				})
				//map.addLayer(markers)
			});
						markerGroup.addTo(map)
						
						map.on('dblclick',function(e){
							//console.log(markerGroup)
							map.removeLayer(markerGroup)
							console.log('dblclick event');
				})
		});

	
		Array.prototype.skiptake = function () {
			if (skip >= this.length) return [];
			
			take = this.length > (skip + take) ? take : (this.length - skip);
			
			var result = this.slice(skip, skip + take);
			skip += take;
			
			return result;		
		}
		function createpolygon(cellGeo){
			var Border=[]; 
			var Inside=[];
			
			cellGeo.features.forEach(function(item){
				if (item.prop == "border"){
					Border.push(createFeature(item.lat,item.lon,item.prop))}
				else {Inside.push(createFeature(item.lat,item.lon,item.prop))}
				
			})
			pointInside=Object.create(point)
			pointBorder=Object.create(point)
			pointBorder.properties=cellGeo.property
			pointInside.properties=cellGeo.property
			pointBorder.features=Border
			pointInside.features=Inside
			
			return [pointInside,pointBorder]
		}
		
		
		function style() {
			var rand=Math.random()
			return {
			weight: 2,
			opacity: 1,
			color: '#'+(0x1000000+(rand)*0xffffff).toString(16).substr(1,6),
			dashArray: '3',
			fillOpacity: 0.6,
			fillColor: '#'+(0x1000000+(rand)*0xffffff).toString(16).substr(1,6)
			};
		}
		
		function createFeatureCollection (cellGeo){
			var features = [];
			var properties=""
			cellGeo.features.forEach(function(item){
				features.push(createFeature(item.lat,item.lon,item.prop))
			})
			poin=Object.create(point)
			poin.properties=cellGeo.property
			poin.features=features
			return poin
		}
		
		function createFeature(lat,lon,prop){
			var feature={
					  "type": "Feature",
					  "property":prop,
					  "geometry":{
						"type": "Point",
						"coordinates": [parseFloat(lon),parseFloat(lat)]
					  }
					}
			
			return feature
		}
		
					
			
		
			
		/*	// hien thi landmark tren ban do
			var arrays = [[10.195312, 43.755225],[10.404052, 43.8424511],[10.579833, 43.659924],[10.360107, 43.516688],[10.14038, 43.588348],[10.195312, 43.755225]]
			
			arrays.forEach(function (item){
			debugger;
					
				L.marker([item[0], item[1]]).addTo(map)
				.bindPopup('A pretty CSS3 popup.<br> Easily customizable.') 
				hien thi noi dung tren land mark
				.openPopup(); 

			}) */
		</script>
    
   </body>
</html>